<div class="voca_main">

  <div class="alert alert-warning alert-dismissible fade show dnone" id="alertid" role="alert">
    <%= errmsg %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  <div class="alert alert-success alert-dismissible fade show dnone" id="alertid2" role="alert">
    <%= successmsg %>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <div class="container-fluid">
    <div class="f_wrapper">
      <div class="folder_wrapper">
        <div class="now_folder">
          <div class="now_folder_location ">
            <% if(pr_id == 0){  %>
              <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-folder2-open" viewBox="0 0 16 16">
                <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14V3.5zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5V6zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/>
              </svg></span>
              <span>Home</span>
            <% }else{ %>
              <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-folder2-open" viewBox="0 0 16 16">
                <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14V3.5zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5V6zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/>
              </svg></span>
              <span>
                <%= gpr_name %>
              </span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-chevron-compact-right"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M6.776 1.553a.5.5 0 0 1 .671.223l3 6a.5.5 0 0 1 0 .448l-3 6a.5.5 0 1 1-.894-.448L9.44 8 6.553 2.224a.5.5 0 0 1 .223-.671z"
                />
              </svg>
              <span>
                <%= fd_name %>
              </span>
            <% } %>
          </div>

          <div class="btn_row">
            <button type="button" class="btn btn-light fd_btn" data-bs-toggle="modal" data-bs-target="#AddFileModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-journal-plus" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 5.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V10a.5.5 0 0 1-1 0V8.5H6a.5.5 0 0 1 0-1h1.5V6a.5.5 0 0 1 .5-.5z"/>
                <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/>
                <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/>
              </svg>  단어장 생성
            </button>
            <button type="button" class="btn btn-light fd_btn" data-bs-toggle="modal" data-bs-target="#AddFolderModal" >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-folder-plus" viewBox="0 0 16 16">
                <path d="m.5 3 .04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8h1.005l.256-2.819A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2zm5.672-1a1 1 0 0 1 .707.293L7.586 3H2.19c-.24 0-.47.042-.683.12L1.5 2.98a1 1 0 0 1 1-.98h3.672z"/>
                <path d="M13.5 10a.5.5 0 0 1 .5.5V12h1.5a.5.5 0 1 1 0 1H14v1.5a.5.5 0 1 1-1 0V13h-1.5a.5.5 0 0 1 0-1H13v-1.5a.5.5 0 0 1 .5-.5z"/>
              </svg>  하위 폴더 생성
            </button>
          </div>
          <div class="btn_row" id="btn_group_id">
            <button type="button" class="btn btn-light fd_btn" data-bs-toggle="modal" data-bs-target="#ModifyFolderModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-folder-symlink" viewBox="0 0 16 16">
                <path d="m11.798 8.271-3.182 1.97c-.27.166-.616-.036-.616-.372V9.1s-2.571-.3-4 2.4c.571-4.8 3.143-4.8 4-4.8v-.769c0-.336.346-.538.616-.371l3.182 1.969c.27.166.27.576 0 .742z"/>
                <path d="m.5 3 .04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14h10.348a2 2 0 0 0 1.991-1.819l.637-7A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2zm.694 2.09A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09l-.636 7a1 1 0 0 1-.996.91H2.826a1 1 0 0 1-.995-.91l-.637-7zM6.172 2a1 1 0 0 1 .707.293L7.586 3H2.19c-.24 0-.47.042-.683.12L1.5 2.98a1 1 0 0 1 1-.98h3.672z"/>
              </svg>  폴더명 변경
            </button>
            <button type="button" class="btn btn-light fd_btn" data-bs-toggle="modal" data-bs-target="#DeleteFolderModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-folder-x" viewBox="0 0 16 16">
                <path d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181L15.546 8H14.54l.265-2.91A1 1 0 0 0 13.81 4H2.19a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91H9v1H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31zm6.339-1.577A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z"/>
                <path d="M11.854 10.146a.5.5 0 0 0-.707.708L12.293 12l-1.146 1.146a.5.5 0 0 0 .707.708L13 12.707l1.146 1.147a.5.5 0 0 0 .708-.708L13.707 12l1.147-1.146a.5.5 0 0 0-.707-.708L13 11.293l-1.146-1.147z"/>
              </svg>  현재 폴더 삭제
            </button>
          </div>
          <div class="btn_row" id="btn_group_id2">
            <form action="/voca/favorites_folder" method="post">
              <input type="hidden" name="fd_id" value="<%= fd_id %>" />
              <input type="hidden" name="fd_name" value="<%= fd_name %>" />
              <input type="hidden" name="pr_id" value="<%= pr_id %>" />
              <button type="submit" class="btn btn-light fd_btn">
                <img class="icon2" id="fd_fav_img" />
                <span id="fd_fav_words"></span>
              </button>
            </form>
            <button type="button" class="btn btn-light fd_btn"  data-bs-toggle="modal" data-bs-target="#ShareFolderModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share" viewBox="0 0 16 16">
                <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
              </svg>
              <span id="fd_sh_words"></span>
            </button>
          </div>
        </div>
        <script>
          if("<%= fd_fav %>" == 1){
            document.getElementById('fd_fav_img').src = '/icons/star1.png'
            document.getElementById('fd_fav_words').innerText = '즐겨찾기 해제'
          }else if("<%= fd_fav %>" == 0){
            document.getElementById('fd_fav_img').src = '/icons/star0.png'
            document.getElementById('fd_fav_words').innerText = '즐겨찾기 등록'
          }
        </script>

        <div class="fold">
          <span class="fold_icon">
            <button type="button" id="downbtn" class="btn btn-secondary dnone">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-expand" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zM7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10z"/>
              </svg>  하위 폴더 열기
            </button>
          </span>
          <span class="fold_icon">
            <button type="button" id="upbtn" class="btn btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-collapse" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zm7-8a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 4.293V.5A.5.5 0 0 1 8 0zm-.5 11.707-1.146 1.147a.5.5 0 0 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 11.707V15.5a.5.5 0 0 1-1 0v-3.793z"/>
              </svg>
                하위 폴더 접기
            </button>
          </span>
          <span class="fold_icon"></span>
        </div>

        <form action="/voca/voca_main" method="post" name="redirect" id="redirect_back">
          <div class="folder cursor" id="goParentBtn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-90deg-left" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M1.146 4.854a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H12.5A2.5 2.5 0 0 1 15 6.5v8a.5.5 0 0 1-1 0v-8A1.5 1.5 0 0 0 12.5 5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4z"/>
            </svg> 상위 폴더로
          </div>
          <input type='hidden' name='fd_id' value='<%= pr_id %>' />
          <input type="hidden" name="fd_name" value="<%= gpr_name %>" />
          <input type="hidden" name="pr_id" value="<%= gpr_id %>" />
        </form>
        <div class="folder_list_wrapper" id="folder_list_wrapper_id">
          
          
          <% for(let i=0; i<folder.length; i++){ %>
              <form action="/voca/voca_main" method="post">
                <input type="hidden" name="fd_id" value="<%= folder[i].folder_id %>" />
                <input type="hidden" name="fd_name" value="<%= folder[i].folder_name %>" />
                <input type="hidden" name="pr_id" value="<%= folder[i].parent_id %>" />
                <button class="folder cursor" id="fdbtn<%= i%>" type="submit">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-folder" viewBox="0 0 16 16">
                    <path d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31zM2.19 4a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91h10.348a1 1 0 0 0 .995-.91l.637-7A1 1 0 0 0 13.81 4H2.19zm4.69-1.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z"/>
                  </svg>
                  <%= folder[i].folder_name %>
                </button>
              </form>
            <% } %>
        </div>
        <script>
          const upbtn = document.getElementById('upbtn');
          const downbtn = document.getElementById('downbtn');
          const goParentBtn = document.getElementById('goParentBtn');

          const fold = (action1, action2) => {
            document.getElementById(action1).style = "display:none";
            document.getElementById(action2).style = "display:inline";
            document.getElementById('folder_list_wrapper_id').classList.toggle('active');
          }

          downbtn.addEventListener("click", () => {
          fold('downbtn','upbtn');
          });

          upbtn.addEventListener("click", () => {
          fold('upbtn', 'downbtn');
          });

          goParentBtn.addEventListener("click", () => {
            document.getElementById('redirect_back').submit()
          });


          if("<%= errmsg %>"){
            document.getElementById('alertid').style = "display:block"
          }
          if("<%= successmsg %>"){
            document.getElementById('alertid2').style = "display:block"
          }
          if("<%= pr_id%>" == '0'){
            document.getElementById("btn_group_id").style = "display: none"
            document.getElementById("btn_group_id2").style = "display: none"
            document.getElementById("redirect_back").style = "display: none"
          }
        </script>
      </div>
      
      <div class="toast-container position-fixed bottom-0 start-50 translate-middle-x p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="toast-header">
            <strong class="me-auto" id="toastMsg"></strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close" id="clostToast"></button>
          </div>
        </div>
      </div>
      
<script>
  const toastLive = document.getElementById('liveToast')
  const clostToast = document.getElementById('clostToast')
  const toastMsg = document.getElementById('toastMsg')
  clostToast.addEventListener("click", () => toastLive.style = 'display:none')
  if('<%= toast %>' == 0){   
    toastLive.style = 'display:block'
    toastMsg.innerText = '즐겨찾기가 해제되었습니다' 
  }else if('<%= toast %>' == 1){
    toastLive.style = 'display:block'
    toastMsg.innerText = '즐겨찾기에 등록되었습니다'
  }else if('<%= toast %>' == 2){
    toastLive.style = 'display:block'
    toastMsg.innerText = '공유가 취소되었습니다'
  }else if('<%= toast %>' == 3){
    toastLive.style = 'display:block'
    toastMsg.innerText = '공유하였습니다'
  }
</script>
      <div class="file_wrapper text-center">
        <div class="container-fluid text-center">
          <div class="voca_file_list row row-cols-auto ">
            <% for(let i=0; i<file.length; i++){ %>
                <div class="col">
                  <div class="voca_file text-center m-2">                    
                      <div class="fileTitle">
                        <form action="/voca/favorites_file" method="post">
                          <button class="icon_btn cursor"><img src="/icons/star<%= file[i].favorites %>.png" class="icon" /></button>
                          <input type="hidden" name="fl_id" value="<%= file[i].file_id %>" />
                          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
                          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
                          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
                        </form>
                        <h6><%= file[i].file_name %></h6>
                        <div class="btn-group dropend dropbtn">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="dropdown-toggle bi bi-three-dots-vertical" viewBox="0 0 16 16"  data-bs-toggle="dropdown" aria-expanded="false">
                            <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                          </svg>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#ModifyFileModal" id="mod_file_btn<%- i %>">단어장명 변경</a></li>
                          <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#DeleteFileModal" id="del_file_btn<%- i %>">단어장 삭제</a></li>
                          <li><a class="dropdown-item">단어장 이동</a></li>
                          <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#ShareFileModal" id="shared_btn<%- i %>" >단어장 공유</a></li>
                        </ul>
                      </div>
                      </div>
                      <div class="filebtnRow">
                        <form action="/voca/voca_load" method="post" name="loadingvoca">
                          <input type="hidden" name="fl_id" value="<%= file[i].file_id %>" />
                          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
                          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
                          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
                          <input type="hidden" name="errmsg" value="" />
                          <input type="submit" class="btn btn-outline-secondary file_btn" value="열기" />
                        </form>
                        <form action="/voca/voca_study" method="post" name="studyingvoca">
                          <input type="hidden" name="fl_id" value="<%= file[i].file_id %>" />
                          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
                          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
                          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
                          <input type="submit" class="btn btn-outline-secondary file_btn" value="공부">
                        </form>
                      </div>
                      <script>
                        if("<%= file[i].shared %>" == 1){
                          document.getElementById('shared_btn<%- i %>').innerText = "단어장 공유 취소"
                          document.getElementById('shared_btn<%- i %>').addEventListener("click",()=>{
                          document.getElementById('sharing_file_Msg').innerText = '단어장 공유를 취소하시겠습니까?';
                          document.getElementById('sharing_file_info').style = 'display:none'
                          document.getElementById('sharing_file_Btn').value = '공유취소'
                        })
                        }else{
                          document.getElementById('shared_btn<%- i %>').addEventListener("click",()=>{
                          document.getElementById('sharing_file_Msg').innerText = '단어장을 회원들과 공유 하시겠습니까?';
                          document.getElementById('sharing_file_Msg2').innerText = '알아보기 쉬운 단어장명으로 설정해주세요';
                        })
                        }
                          document.getElementById('mod_file_btn<%- i %>').addEventListener("click",()=>{
                          document.getElementById('mod_fl_id').value = "<%= file[i].file_id %>";
                        })
                          document.getElementById('del_file_btn<%- i %>').addEventListener("click",()=>{
                          document.getElementById('del_fl_id').value = "<%= file[i].file_id %>";
                        })
                      </script>
                  </div>
                </div>
              <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- 모달 -->

<div class="modal fade" id="AddFolderModal" tabindex="-1" aria-hidden="true">
  <form action="/voca/create_folder" method="post">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">폴더 생성</h5>
        </div>
        <div class="modal-body">
          <input type="text" name="new_fd_name" placeholder="추가하실 폴더이름을 입력해주세요"  id="newfolderid" class="form-control is-val w100"  minlength="1" maxlength="21"  />
          <div class="invalid-feedback">
            폴더명은 1~20자로 해주세요
          </div>
          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button type="submit" class="btn btn-primary" id="newfolderbtn" disabled>생성하기</button>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="modal fade" id="AddFileModal" tabindex="-1"  aria-hidden="true">
  <form action="/voca/create_file" method="post">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">단어장 생성</h5>
        </div>
        <div class="modal-body">
          <input type="text" name="new_fl_name" placeholder="추가하실 단어장 이름을 입력해주세요"   id="newfileid" class="form-control is-val w100" minlength="1" maxlength="21" />
          <div class="invalid-feedback">
            단어장명은 1~20자로 해주세요
          </div>
          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button type="submit" class="btn btn-primary" id="newfilebtn" disabled>생성하기</button>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="modal fade" id="ModifyFolderModal" tabindex="-1" aria-hidden="true">
  <form action="/voca/modify_folder" method="post">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">폴더명 변경</h5>
        </div>
        <div class="modal-body">
          <input type="text" name="new_fd_name" placeholder="변경하실 폴더 이름을 입력해주세요" id="modfolderid" class="form-control is-val w100" minlength="1" maxlength="21" />
          <div class="invalid-feedback">
            폴더명은 1~20자로 해주세요
          </div>
          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button type="submit" class="btn btn-primary" id="modfolderbtn" disabled>변경하기</button>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="modal fade" id="DeleteFolderModal" tabindex="-1" aria-hidden="true">
  <form action="/voca/delete_folder" method="post">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">폴더 삭제</h5>
        </div>
        <div class="modal-body">
          정말 <%= fd_name %> 폴더를 삭제하시겠습니까?
          <input type='hidden' name='pfd_id' value='<%= fd_id %>' />
          <input type='hidden' name='fd_id' value='<%= pr_id %>' />
          <input type="hidden" name="fd_name" value="<%= gpr_name %>" />
          <input type="hidden" name="pr_id" value="<%= gpr_id %>" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button type="submit" class="btn btn-primary">삭제하기</button>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="modal fade" id="Godelmodal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5">정말 계정을 삭제하시겠습니까?</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        계정 내의 모든 데이터가 삭제됩니다.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
        <form method="post" action="/signpage/delete_member">
          <button type="submit" class="btn btn-primary">삭제하기</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="ShareFolderModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
  <form action="/voca/share_folder" method="post">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5">폴더 공유</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <span id="sharing_fd_Msg"></span>
          <br>
          <div class="share_info" id="sharing_fd_info"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle share_info_icon" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
          </svg><span id="sharing_fd_Msg2"></span></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <input type="submit" class="btn btn-primary" id="sharing_fd_Btn" />
          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
        </div>
      </div>
    </div>
  </form>
</div>

<div class="modal fade" id="ModifyFileModal" tabindex="-1" aria-hidden="true">
  <form action="/voca/modify_file" method="post">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">단어장명 변경</h5>
        </div>
        <div class="modal-body">
          <input type="text" name="new_fl_name" placeholder="변경하실 단어장 이름을 입력해주세요"  id="modfileid" class="form-control is-val w100" minlength="1" maxlength="21" />
          <div class="invalid-feedback">
            단어장명은 1~20자로 해주세요
          </div>
          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
          <input type="hidden" name="fl_id" id="mod_fl_id" />
          <script>
            document.getElementById('modfileid').addEventListener('keyup', () =>{
              isValid('text','modfile',20)
            })
          </script>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button type="submit" class="btn btn-primary" id="modfilebtn" disabled>변경하기</button>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="modal fade" id="DeleteFileModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
  <form action="/voca/delete_file" method="post" name="deletefileform">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5">단어장 삭제</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          정말 삭제하시겠습니까? 단어장 내 모든 데이터가 삭제됩니다.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <input type="submit" class="btn btn-primary" value="삭제" />
          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
          <input type="hidden" name="fl_id" id="del_fl_id"  />
        </div>
      </div>
    </div>
  </form>
</div>

<div class="modal fade" id="ShareFileModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
  <form action="/voca/share_file" method="post">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5">단어장 공유</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <span id="sharing_file_Msg"></span>
          <br>
          <div class="share_info" id="sharing_file_info"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle share_info_icon" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
          </svg><span id="sharing_file_Msg2"></span></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <input type="submit" class="btn btn-primary" value="공유" id="sharing_file_Btn" />
          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
          <input type="hidden" name="fl_id" id="sha_fl_id" />
        </div>
      </div>
    </div>
  </form>
</div>

<button
  type="button"
  class="btn btn-primary dnone"
  data-bs-toggle="modal"
  data-bs-target="#ChangePasswordModal"
  id="hiddenmodalbtn"
></button>
<button
  type="button"
  class="btn btn-primary dnone"
  data-bs-toggle="modal"
  data-bs-target="#Godelmodal"
  id="hiddenmodalbtn2"
></button>

<script>
  document.getElementById('newfolderid').addEventListener('keyup', () =>{
    isValid('text','newfolder',20)
  })

  document.getElementById('newfileid').addEventListener('keyup', () =>{
    isValid('text','newfile',20)
  })

  document.getElementById('modfolderid').addEventListener('keyup', () =>{
    isValid('text','modfolder',20)
  })

  if("<%= fd_sh %>" == 1){
    document.getElementById('fd_sh_words').innerText = '공유 해제하기';
    document.getElementById('sharing_fd_Msg').innerText = '폴더 공유를 취소하시겠습니까?';
    document.getElementById('sharing_fd_info').style = 'display:none';
    document.getElementById('sharing_fd_Btn').value = '공유취소';
  }else if("<%= fd_sh %>" == 0){
    document.getElementById('fd_sh_words').innerText = '폴더 공유하기';
    document.getElementById('sharing_fd_Btn').value = '폴더 공유';
    document.getElementById('sharing_fd_Msg').innerText = '폴더를 회원들과 공유 하시겠습니까?';
    document.getElementById('sharing_fd_Msg2').innerText = '알아보기 쉬운 폴더명으로 설정해주세요';
  }

  document.getElementById("fav_load_btn").addEventListener("click", () => {
    fetch("/voca/load_fav")
      .then((res) => res.json())
      .then((fav) => {
        fav_file = fav[0];
        fav_folder = fav[1];
        let fav_filelist = "";
        let fav_folderlist = "";
        for (let i = 0; i < fav_folder.length; i++) {
          fav_folderlist += `
      <form action="/voca/voca_main" method="post">
        <input type="hidden" name="fd_id" value="${fav_folder[i].folder_id}" />
        <input type="hidden" name="fd_name" value="${fav_folder[i].folder_name}" />
        <input type="hidden" name="pr_id" value="${fav_folder[i].parent_id}" />
        <button class="folder cursor" id="fdbtn${i}" type='submit'>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-folder" viewBox="0 0 16 16">
            <path d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31zM2.19 4a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91h10.348a1 1 0 0 0 .995-.91l.637-7A1 1 0 0 0 13.81 4H2.19zm4.69-1.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z"/>
          </svg>
          ${fav_folder[i].folder_name}
        </button>
      </form>
      `;
        }
        for (let i = 0; i < fav_file.length; i++) {
          fav_filelist += `
      <div class="fav_voca_file text-center m-2">                    
        <div class="fileTitle">
          <form action="/voca/favorites_file" method="post">
            <button class="icon_btn cursor"><img src="/icons/star1.png" class="icon" /></button>
            <input type="hidden" name="fl_id" value="${fav_file[i].file_id}" />
            <input type="hidden" name="fd_id" value="<%= fd_id %>" />
            <input type="hidden" name="fd_name" value="<%= fd_name %>" />
            <input type="hidden" name="pr_id" value="<%= pr_id %>" />
          </form>
          <h6>${fav_file[i].file_name}</h6>
      </div>
      <div class="filebtnRow">
        <form action="/voca/voca_load" method="post">
          <button type='submit' class="btn btn-outline-secondary file_btn">열기</button>
          <input type="hidden" name="fl_id" value="${fav_file[i].file_id}" />
          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
          <input type="hidden" name="errmsg" value="" />
        </form>
        <form action="/voca/voca_study" method="post">
          <button type='submit' class="btn btn-outline-secondary file_btn">공부</button>
          <input type="hidden" name="fl_id" value="${fav_file[i].file_id}" />
          <input type="hidden" name="fd_id" value="<%= fd_id %>" />
          <input type="hidden" name="fd_name" value="<%= fd_name %>" />
          <input type="hidden" name="pr_id" value="<%= pr_id %>" />
        </form>
      </div>
    </div>
    `;
        }
        document.getElementById("fav_fl_area").innerHTML = fav_filelist;
        document.getElementById("fav_fd_area").innerHTML = fav_folderlist;
      });
  });

  document.getElementById("voca_tab_click_id").addEventListener("click", () => {
    location.href = "/voca";
  });

  if("<%- modal %>" == "delete"){
    setTimeout(() => {
      document.getElementById("hiddenmodalbtn2").click();
    }, 100);
  }else if("<%- modal %>" == "change"){
    setTimeout(() => {
      document.getElementById("hiddenmodalbtn").click();
    }, 100);
  }

  document.getElementById("settmodalbtn").addEventListener("click", () => {
    fetch("/voca/get_user")
      .then((res) => res.json())
      .then((user) => {
        document.getElementById(
          "user_email_area"
        ).innerText = `이메일 : ${user.email}`;
        document.getElementById(
          "user_nick_area"
        ).innerText = `닉네임 : ${user.nickname}`;
        document.getElementById(
          "user_regi_area"
        ).innerText = `가입날짜 : ${user.registered}`;
        document.getElementById("nickinputid").placeholder = user.nickname;
      });
  });
</script>
